{% extends 'single_page/base.html' %}
{% block main_area %}
{% load static %}

<!-- Ïô∏Î∂Ä Ïä§ÌÉÄÏùº ÏãúÌä∏ Î°úÎî© -->
<link rel="stylesheet" href="{% static 'single_page/pretendard.css' %}">

<style>
    .faq-detail-table {
        width: 50%;
        margin: 40px auto;
        border-collapse: collapse;
        background-color: black;
    }
    .faq-detail-table th, .faq-detail-table td {
        border: 1px solid black;
        padding: 8px;
        text-align: center;
    }
    .faq-detail-table th {
        background-color: lightgray;
    }
    .faq-detail-table td {
        background-color: white;
    }
    h3 {
        font-weight: 700;
    }
  
    #chatbot-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 300px;
        z-index: 1000;
    }

    #chatbot {
        background-color: #f8f9fa;
        border: 1px solid #ccc;
        border-radius: 10px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        height: 300px;
    }

    #chatbot-header {
        background-color: #007bff;
        color: white;
        padding: 10px;
        border-radius: 10px 10px 0 0;
        text-align: center;
    }

    #chatbot-body {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        border-bottom: 1px solid #ccc;
    }

    #chatbot-messages {
        margin-bottom: 10px;
    }

    .user {
        text-align: right;
        color: #007bff;
    }

    .bot {
        text-align: left;
        color: #333;
    }

    #chatbot-form {
        display: flex;
        padding: 10px;
        border-top: 1px solid #ccc;
    }

    #user-input {
        flex: 1;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    #chatbot-send {
        padding: 5px 10px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-left: 10px;
    }

</style>

<div class="mx-auto p-2" style="width: auto;">
    <div class="d-flex justify-content-center">
        <h3>Î¨∏ÏùòÏÇ¨Ìï≠</h3>
    </div>
</div>
<form action="{% url 'qna:blog' %}" method="POST">
    {% csrf_token %}
    <div class="container">
        <div class="my-3">
            <div class="float-end">
                <a button type="button" class="btn btn-primary"
                    style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: 1rem; margin-bottom: 2rem;" href="new_post/">ÏûëÏÑ±</a>
            </div>
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col"></th>
                        <th scope="col">Ï†úÎ™©</th>
                        <th scope="col">ÎãµÎ≥Ä</th>
                        <th scope="col">ÎÇ†Ïßú</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ÏûêÏ£º Î¨ªÎäî ÏßàÎ¨∏ -->
                    {% for list in faqlist %}
                        <tr>
                            <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;üìå&nbsp;</td>
                            <td>
                                <a href="password/{{ list.pk }}/">{{ list.postname }}</a>
                            </td>
                            <td>ÏûêÏ£º Î¨ªÎäî ÏßàÎ¨∏</td>
                            <td>{{ list.created_at }}</td>
                        </tr>
                    {% endfor %}
                    <!-- ÏùºÎ∞ò ÏßàÎ¨∏ -->
                    {% for list in postlist %}
                        <tr>
                            <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;üîí&nbsp;</td>
                            <td>
                                <a href="password/{{ list.pk }}/">{{ list.postname }}</a>
                            </td>
                            <td>
                                {% if list.answer %}
                                    ÎãµÎ≥Ä ÏôÑÎ£å
                                {% else %}
                                    ÎãµÎ≥Ä ÎØ∏ÏôÑÎ£å
                                {% endif %}
                            </td>
                            <td>{{ list.created_at }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
            <div class="d-flex justify-content-center">
                <ul class="pagination">
                    <!-- Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ -->
                    {% if postlist.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ postlist.previous_page_number }}">Ïù¥Ï†Ñ</a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <a class="page-link" tabindex="-1" aria-disabled="true" href="#">Ïù¥Ï†Ñ</a>
                    </li>
                    {% endif %}
                    
                    <!-- ÌéòÏù¥ÏßÄ Î≤àÌò∏ -->
                    {% for page_number in postlist.paginator.page_range %}
                        {% if page_number >= postlist.number|add:-5 and page_number <= postlist.number|add:5 %}
                            {% if page_number == postlist.number %}
                            <li class="page-item active" aria-current="page">
                                <a class="page-link" href="?page={{ page_number }}">{{ page_number }}</a>
                            </li>
                            {% else %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_number }}">{{ page_number }}</a>
                            </li>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
    
                    <!-- Îã§Ïùå ÌéòÏù¥ÏßÄ -->
                    {% if postlist.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ postlist.next_page_number }}">Îã§Ïùå</a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <a class="page-link" tabindex="-1" aria-disabled="true" href="#">Îã§Ïùå</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>
</form>

<!-- Ï±óÎ¥á ÌåùÏóÖ Ï∂îÍ∞Ä -->
<div id="chatbot-container">
    <div id="chat-box">
    </div>
    
    <form id="chat-form" method="post">
        <input type="text" id="user_input" name="user_input" placeholder="Type your message here" style="width: 80%;">
        <button type="submit">Send</button>
    </form>
</div>


<script>
    document.getElementById('chat-form').onsubmit = function(e) {
        e.preventDefault();
        const userInput = document.getElementById('user_input').value;
        
        const chatBox = document.getElementById('chat-box');
        chatBox.innerHTML += `<div class="user">${userInput}</div>`;
        
        fetch("{% url 'qna:chatbot_response' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: `user_input=${encodeURIComponent(userInput)}`
        })
        .then(response => response.json())
        .then(data => {
            chatBox.innerHTML += `<div class="bot">${data.result}</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        })
        .catch(error => {
            chatBox.innerHTML += `<div class="bot">Error: ${error.message}</div>`;
        });
        
        document.getElementById('user_input').value = '';
    };
</script>


{% endblock %}
